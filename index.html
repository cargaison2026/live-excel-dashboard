<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Safety Executive Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
.chart-box{
height:260px;
}
</style>

</head>
<body class="bg-gray-100">

<div class="max-w-7xl mx-auto p-6">

<h1 class="text-3xl font-bold mb-4">Safety & Violation Executive Dashboard</h1>

<!-- KPI -->
<div class="grid grid-cols-4 gap-4 mb-6">

<div class="bg-white p-4 rounded shadow">
<div class="text-gray-500 text-sm">Total Violations</div>
<div id="kpiTotal" class="text-2xl font-bold">0</div>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="text-gray-500 text-sm">OOS Violations</div>
<div id="kpiOOS" class="text-2xl font-bold text-red-600">0</div>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="text-gray-500 text-sm">Total Severity Weight</div>
<div id="kpiWeight" class="text-2xl font-bold text-orange-600">0</div>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="text-gray-500 text-sm">Average Severity</div>
<div id="kpiAvg" class="text-2xl font-bold text-green-600">0</div>
</div>

</div>


<!-- Charts -->
<div class="grid grid-cols-2 gap-6">

<div class="bg-white p-4 rounded shadow">
<div class="font-semibold mb-2">Violation by BASIC</div>
<canvas id="basicChart" class="chart-box"></canvas>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="font-semibold mb-2">Violation by Company</div>
<canvas id="companyChart"></canvas>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="font-semibold mb-2">OOS vs Non OOS</div>
<canvas id="oosChart"></canvas>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="font-semibold mb-2">Monthly Trend</div>
<canvas id="trendChart"></canvas>
</div>

</div>

</div>


<script>


// PUT YOUR GITHUB RAW CSV LINK HERE
const csvUrl = "https://raw.githubusercontent.com/YOUR_USERNAME/YOUR_REPO/main/VIOLATION%20SHEET%202026.csv";


let charts = {};


// Load CSV
fetch(csvUrl)
.then(res => res.text())
.then(csv => {

const data = parseCSV(csv);

updateKPI(data);
createCharts(data);

});




// CSV parser
function parseCSV(text){

const rows = text.split("\n").slice(1);

return rows.map(r=>{

const cols = r.split(",");

return {

company: cols[3],
driver: cols[9],
basic: cols[11],
weight: Number(cols[15]) || 0,
oos: cols[16]?.trim().toUpperCase() === "YES",
month: cols[19]

};

});

}




// KPI
function updateKPI(data){

const total = data.length;
const oos = data.filter(x=>x.oos).length;
const weight = data.reduce((a,b)=>a+b.weight,0);

document.getElementById("kpiTotal").innerText = total;
document.getElementById("kpiOOS").innerText = oos;
document.getElementById("kpiWeight").innerText = weight;
document.getElementById("kpiAvg").innerText = (weight/total).toFixed(1);

}



// Charts
function createCharts(data){

// BASIC
const basic = groupSum(data,"basic");

charts.basic = new Chart(basicChart,{
type:"doughnut",
data:{
labels:Object.keys(basic),
datasets:[{data:Object.values(basic)}]
}
});


// Company
const company = groupSum(data,"company");

charts.company = new Chart(companyChart,{
type:"bar",
data:{
labels:Object.keys(company),
datasets:[{data:Object.values(company)}]
}
});


// OOS
const oosCount = data.filter(x=>x.oos).length;

charts.oos = new Chart(oosChart,{
type:"pie",
data:{
labels:["OOS","Non OOS"],
datasets:[{
data:[oosCount,data.length-oosCount]
}]
}
});


// Trend
const trend = groupSum(data,"month");

charts.trend = new Chart(trendChart,{
type:"line",
data:{
labels:Object.keys(trend),
datasets:[{
data:Object.values(trend)
}]
}
});

}



// helper
function groupSum(data,key){

const result={};

data.forEach(d=>{
result[d[key]]=(result[d[key]]||0)+d.weight;
});

return result;

}


</script>

</body>
</html>
