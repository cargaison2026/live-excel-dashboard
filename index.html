<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Violation Dashboard 2026</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
.chart-box{height:260px;}
</style>
</head>

<body class="bg-gray-100">

<div class="max-w-7xl mx-auto p-6">

<h1 class="text-3xl font-bold mb-6">
Violation Dashboard 2026
</h1>


<!-- FILTERS -->
<div class="bg-white p-4 rounded shadow mb-6 flex gap-6">

<div>
<label class="text-sm text-gray-500">Company</label><br>
<select id="companyFilter" class="border p-2 rounded">
<option value="All">All</option>
</select>
</div>

<div>
<label class="text-sm text-gray-500">Driver</label><br>
<select id="driverFilter" class="border p-2 rounded">
<option value="All">All</option>
</select>
</div>

</div>



<!-- KPI -->
<div class="grid grid-cols-5 gap-4 mb-6">

<div class="bg-white p-4 rounded shadow">
<div class="text-gray-500 text-sm">Total Violations</div>
<div id="kpiTotal" class="text-2xl font-bold">0</div>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="text-gray-500 text-sm">OOS Violations</div>
<div id="kpiOOS" class="text-2xl font-bold text-red-600">0</div>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="text-gray-500 text-sm">Total Weight</div>
<div id="kpiWeight" class="text-2xl font-bold text-orange-600">0</div>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="text-gray-500 text-sm">Average Weight</div>
<div id="kpiAvg" class="text-2xl font-bold text-green-600">0</div>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="text-gray-500 text-sm">Risk Score</div>
<div id="riskScore" class="text-2xl font-bold">0</div>
</div>

</div>



<!-- Charts -->
<div class="grid grid-cols-2 gap-6">

<div class="bg-white p-4 rounded shadow">
<div class="font-semibold mb-2">Violation by BASIC</div>
<canvas id="basicChart" class="chart-box"></canvas>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="font-semibold mb-2">Violation by Company</div>
<canvas id="companyChart"></canvas>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="font-semibold mb-2">OOS vs Non OOS</div>
<canvas id="oosChart"></canvas>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="font-semibold mb-2">Monthly Trend</div>
<canvas id="trendChart"></canvas>
</div>

<div class="bg-white p-4 rounded shadow col-span-2">
<div class="font-semibold mb-2">Top 10 Worst Drivers (By Weight)</div>
<canvas id="topDriverChart"></canvas>
</div>

</div>

</div>



<script>

const csvUrl = "https://raw.githubusercontent.com/YOUR_USERNAME/YOUR_REPO/main/VIOLATION%20SHEET%202026.csv";

let fullData = [];
let charts = {};

fetch(csvUrl)
.then(res => res.text())
.then(csv => {

fullData = parseCSV(csv);

populateFilters();
applyFilters();

});



function parseCSV(text){

const rows = text.split("\n").slice(1);

return rows.map(r=>{

const c = r.split(",");

return {
company:c[3],
driver:c[9],
basic:c[11],
weight:Number(c[15])||0,
oos:c[16]?.trim().toUpperCase()==="YES",
month:c[19]
};

});

}



function populateFilters(){

const companies = [...new Set(fullData.map(x=>x.company))];

companies.forEach(c=>{
companyFilter.innerHTML += `<option value="${c}">${c}</option>`;
});

companyFilter.addEventListener("change",()=>{
updateDriverFilter();
applyFilters();
});

driverFilter.addEventListener("change",applyFilters);

updateDriverFilter();
}



function updateDriverFilter(){

driverFilter.innerHTML='<option value="All">All</option>';

let selectedCompany = companyFilter.value;

let drivers = fullData
.filter(x=> selectedCompany==="All" || x.company===selectedCompany)
.map(x=>x.driver);

drivers = [...new Set(drivers)];

drivers.forEach(d=>{
driverFilter.innerHTML += `<option value="${d}">${d}</option>`;
});

}



function applyFilters(){

let data = fullData;

if(companyFilter.value!=="All"){
data = data.filter(x=>x.company===companyFilter.value);
}

if(driverFilter.value!=="All"){
data = data.filter(x=>x.driver===driverFilter.value);
}

updateKPI(data);
createCharts(data);

}



function updateKPI(data){

const total = data.length;
const oos = data.filter(x=>x.oos).length;
const weight = data.reduce((a,b)=>a+b.weight,0);
const avg = total ? (weight/total).toFixed(1) : 0;

document.getElementById("kpiTotal").innerText = total;
document.getElementById("kpiOOS").innerText = oos;
document.getElementById("kpiWeight").innerText = weight;
document.getElementById("kpiAvg").innerText = avg;

const risk = weight > 500 ? "High" : weight > 200 ? "Medium" : "Low";

const riskBox = document.getElementById("riskScore");
riskBox.innerText = risk;

riskBox.className = "text-2xl font-bold " +
(risk==="High"?"text-red-600":risk==="Medium"?"text-yellow-600":"text-green-600");

}



function createCharts(data){

Object.values(charts).forEach(c=>c.destroy());

charts.basic = new Chart(basicChart,{
type:"doughnut",
data:{labels:Object.keys(group(data,"basic")),
datasets:[{data:Object.values(group(data,"basic"))}]}
});

charts.company = new Chart(companyChart,{
type:"bar",
data:{labels:Object.keys(group(data,"company")),
datasets:[{data:Object.values(group(data,"company"))}]}
});

charts.oos = new Chart(oosChart,{
type:"pie",
data:{
labels:["OOS","Non OOS"],
datasets:[{data:[
data.filter(x=>x.oos).length,
data.filter(x=>!x.oos).length
]}]
}
});

charts.trend = new Chart(trendChart,{
type:"line",
data:{labels:Object.keys(group(data,"month")),
datasets:[{data:Object.values(group(data,"month"))}]}
});


// Top 10 drivers
let driverMap = group(data,"driver");

let sorted = Object.entries(driverMap)
.sort((a,b)=>b[1]-a[1])
.slice(0,10);

charts.top = new Chart(topDriverChart,{
type:"bar",
data:{
labels:sorted.map(x=>x[0]),
datasets:[{data:sorted.map(x=>x[1])}]
}
});

}



function group(data,key){

const result={};

data.forEach(d=>{
result[d[key]]=(result[d[key]]||0)+d.weight;
});

return result;

}

</script>

</body>
</html>
