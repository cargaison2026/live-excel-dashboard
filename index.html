<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Safety & Violation Executive Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{
font-family: Arial, sans-serif;
background:#f3f4f6;
padding:30px;
}

h1{
margin-bottom:25px;
}

.kpi-container{
display:flex;
gap:20px;
margin-bottom:40px;
}

.kpi{
background:white;
flex:1;
padding:20px;
border-radius:10px;
box-shadow:0 4px 12px rgba(0,0,0,0.08);
text-align:center;
}

.kpi h2{
margin:0;
font-size:30px;
color:#111827;
}

.kpi p{
margin-top:6px;
color:#6b7280;
}

.grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:30px;
}

canvas{
background:white;
padding:20px;
border-radius:10px;
box-shadow:0 4px 12px rgba(0,0,0,0.08);
}
</style>
</head>

<body>

<h1>Safety & Violation Executive Dashboard</h1>

<div class="kpi-container">

<div class="kpi">
<h2 id="total">0</h2>
<p>Total Violations</p>
</div>

<div class="kpi">
<h2 id="oos">0</h2>
<p>Out of Service</p>
</div>

<div class="kpi">
<h2 id="totalWeight">0</h2>
<p>Total Severity Weight</p>
</div>

<div class="kpi">
<h2 id="avgWeight">0</h2>
<p>Average Weight / Violation</p>
</div>

</div>

<div class="grid">

<canvas id="basicChart"></canvas>
<canvas id="companyChart"></canvas>
<canvas id="oosChart"></canvas>
<canvas id="weekChart"></canvas>

</div>

<script>

const csvUrl = "VIOLATION SHEET 2026.csv";

Papa.parse(csvUrl, {
download: true,
header: true,

complete: function(results){

const data = results.data.filter(row => row["Driver Name"]);

const total = data.length;

const oos = data.filter(row =>
row["Out of Service"] &&
row["Out of Service"].toUpperCase() === "YES"
).length;

const totalWeight = data.reduce((sum,row)=>
sum + Number(row["TOTAL Weight"] || 0),0);

const avgWeight = total > 0 ? totalWeight / total : 0;

document.getElementById("total").innerText = total;
document.getElementById("oos").innerText = oos;
document.getElementById("totalWeight").innerText = totalWeight;
document.getElementById("avgWeight").innerText = avgWeight.toFixed(2);

function groupBy(field){
const map = {};
data.forEach(row=>{
const key = row[field] || "Unknown";
map[key] = (map[key] || 0) + 1;
});
return map;
}

function createChart(id,type,labels,values,label){
new Chart(document.getElementById(id),{
type:type,
data:{
labels:labels,
datasets:[{
label:label,
data:values
}]
},
options:{
responsive:true,
plugins:{
legend:{display:true}
}
}
});
}

const basicData = groupBy("BASIC");
createChart(
"basicChart",
"bar",
Object.keys(basicData),
Object.values(basicData),
"Violations by BASIC Category"
);

const companyData = groupBy("Company");
createChart(
"companyChart",
"bar",
Object.keys(companyData),
Object.values(companyData),
"Violations by Company"
);

const oosData = groupBy("Out of Service");
createChart(
"oosChart",
"pie",
Object.keys(oosData),
Object.values(oosData),
"OOS Distribution"
);

const weekData = groupBy("Week");
createChart(
"weekChart",
"line",
Object.keys(weekData),
Object.values(weekData),
"Weekly Violation Trend"
);

}

});

</script>

</body>
</html>
