<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">

<title>Violation Dashboard 2026</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

<script src="https://cdn.tailwindcss.com"></script>

<style>
.chart-box{
height:260px;
}
</style>

</head>

<body class="bg-gray-100">

<div class="max-w-7xl mx-auto p-6">

<h1 class="text-3xl font-bold mb-6">
Violation Dashboard 2026
</h1>


<!-- KPI -->
<div class="grid grid-cols-4 gap-4 mb-6">

<div class="bg-white p-4 rounded shadow">
<div class="text-gray-500">Total Violations</div>
<div id="kpiTotal" class="text-2xl font-bold">0</div>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="text-gray-500">OOS Violations</div>
<div id="kpiOOS" class="text-2xl font-bold text-red-600">0</div>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="text-gray-500">Total Weight</div>
<div id="kpiWeight" class="text-2xl font-bold text-orange-600">0</div>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="text-gray-500">Avg Weight</div>
<div id="kpiAvg" class="text-2xl font-bold text-green-600">0</div>
</div>

</div>


<!-- Charts -->
<div class="grid grid-cols-2 gap-6 mb-6">

<div class="bg-white p-4 rounded shadow">
<div class="font-semibold mb-2">Violation by BASIC</div>
<canvas id="basicChart"></canvas>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="font-semibold mb-2">Violation by Company</div>
<canvas id="companyChart"></canvas>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="font-semibold mb-2">OOS vs Non OOS</div>
<canvas id="oosChart"></canvas>
</div>

<div class="bg-white p-4 rounded shadow">
<div class="font-semibold mb-2">Monthly Total Weight</div>
<canvas id="monthChart"></canvas>
</div>

</div>


<!-- Driver Table -->
<div class="bg-white p-4 rounded shadow">

<div class="font-semibold mb-4">
Driver Violation List
</div>

<div class="overflow-auto max-h-96">

<table class="min-w-full text-sm">

<thead class="bg-gray-200">

<tr>

<th class="p-2 text-left">Driver</th>
<th class="p-2 text-left">Truck</th>
<th class="p-2 text-left">Date</th>
<th class="p-2 text-left">Violation</th>
<th class="p-2 text-left">BASIC</th>
<th class="p-2 text-left">Weight</th>

</tr>

</thead>

<tbody id="tableBody"></tbody>

</table>

</div>

</div>


</div>



<script>


// PUT YOUR GITHUB CSV LINK HERE
const csvUrl =
"VIOLATION SHEET 2026.csv";


fetch(csvUrl)
.then(res=>res.text())
.then(csv=>{

const data=parseCSV(csv);

updateKPI(data);

createCharts(data);

createTable(data);

});




function parseCSV(text){

const rows=text.split("\n").slice(1);

return rows.map(r=>{

const c=r.split(",");

return{

company:c[3],
truck:c[8],
driver:c[9],
date:c[10],
basic:c[11],
violation:c[12],
weight:Number(c[15])||0,
oos:c[16]=="YES",
month:c[19]

};

});

}



function updateKPI(data){

const total=data.length;

const oos=data.filter(x=>x.oos).length;

const weight=data.reduce((a,b)=>a+b.weight,0);

document.getElementById("kpiTotal").innerText=total;

document.getElementById("kpiOOS").innerText=oos;

document.getElementById("kpiWeight").innerText=weight;

document.getElementById("kpiAvg").innerText=
(weight/total).toFixed(1);

}




function createCharts(data){

Chart.register(ChartDataLabels);


// BASIC
createChart(
"basicChart",
"doughnut",
group(data,"basic")
);


// Company
createChart(
"companyChart",
"bar",
group(data,"company")
);


// OOS
createChart(
"oosChart",
"pie",
{
"OOS":data.filter(x=>x.oos).length,
"Non OOS":data.filter(x=>!x.oos).length
}
);


// Month
createChart(
"monthChart",
"line",
group(data,"month")
);

}



function createChart(id,type,obj){

new Chart(
document.getElementById(id),
{

type:type,

data:{
labels:Object.keys(obj),
datasets:[{
data:Object.values(obj)
}]
},

options:{

plugins:{
datalabels:{
color:"black",
anchor:"end",
align:"top"
}
}

}

});

}




function group(data,key){

const result={};

data.forEach(d=>{

result[d[key]]=
(result[d[key]]||0)+d.weight;

});

return result;

}




function createTable(data){

const body=document.getElementById("tableBody");

body.innerHTML="";

data.slice(0,200).forEach(d=>{

body.innerHTML+=`

<tr class="border-b">

<td class="p-2">${d.driver}</td>
<td class="p-2">${d.truck}</td>
<td class="p-2">${d.date}</td>
<td class="p-2">${d.violation}</td>
<td class="p-2">${d.basic}</td>
<td class="p-2 font-semibold">${d.weight}</td>

</tr>

`;

});

}



</script>


</body>
</html>
