<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Violation Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
body{
font-family:Arial;
background:#f4f6f9;
padding:20px;
}

.kpi{
display:inline-block;
background:white;
padding:20px;
margin:10px;
border-radius:8px;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
width:200px;
text-align:center;
}

canvas{
background:white;
margin-top:20px;
padding:15px;
border-radius:8px;
box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
</style>

</head>

<body>

<h1>Live Safety Dashboard</h1>

<div class="kpi">
<h2 id="total">0</h2>
Total Violations
</div>

<div class="kpi">
<h2 id="oos">0</h2>
Out of Service
</div>

<div class="kpi">
<h2 id="weight">0</h2>
Total Weight
</div>

<br>

<canvas id="chart1"></canvas>
<canvas id="chart2"></canvas>

<script>

const csvUrl = "VIOLATION SHEET 2026.csv";

Papa.parse(csvUrl,{
download:true,
header:true,

complete:function(results){

const data = results.data.filter(x=>x["Driver Name"]);

document.getElementById("total").innerText = data.length;

const oos = data.filter(x=>x["Out of Service"]==="YES").length;
document.getElementById("oos").innerText = oos;

const weight = data.reduce((a,b)=>a+Number(b["TOTAL Weight"]||0),0);
document.getElementById("weight").innerText = weight;

const basicCount={};

data.forEach(row=>{
const key=row["BASIC"];
basicCount[key]=(basicCount[key]||0)+1;
});

new Chart(document.getElementById("chart1"),{
type:"bar",
data:{
labels:Object.keys(basicCount),
datasets:[{
label:"Violations by BASIC",
data:Object.values(basicCount)
}]
}
});

const companyCount={};

data.forEach(row=>{
const key=row["Company"];
companyCount[key]=(companyCount[key]||0)+1;
});

new Chart(document.getElementById("chart2"),{
type:"pie",
data:{
labels:Object.keys(companyCount),
datasets:[{
data:Object.values(companyCount)
}]
}
});

}

});

</script>

</body>
</html>
